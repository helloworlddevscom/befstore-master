"use strict";var WPMailSMTPDashboardWidget=window.WPMailSMTPDashboardWidget||function(s){var i={$widget:s("#wp_mail_smtp_reports_widget_pro"),$daysSelect:s("#wp-mail-smtp-dash-widget-timespan"),$emailTypeSelect:s("#wp-mail-smtp-dash-widget-email-type"),$canvas:s("#wp-mail-smtp-dash-widget-chart"),$emailStatsBlock:s("#wp-mail-smtp-dash-widget-email-stats-block"),$recomBlockDismissBtn:s("#wp-mail-smtp-dash-widget-dismiss-recommended-plugin-block"),$settingsBtn:s("#wp-mail-smtp-dash-widget-settings-button")},a=wp_mail_smtp_dashboard_widget.no_send_confirmations?[{label:wp_mail_smtp_dashboard_widget.texts.sent_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"}]:[{label:wp_mail_smtp_dashboard_widget.texts.confirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.unconfirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(167, 170, 173, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"}],d={instance:null,cachedData:{confirmed:[],unconfirmed:[],sent:[],failed:[]},settings:{type:"line",data:{labels:[],datasets:a.slice()},options:{maintainAspectRatio:!1,scales:{xAxes:[{type:"time",time:{unit:"day",tooltipFormat:"MMM D"},distribution:"series",ticks:{beginAtZero:!0,source:"labels",padding:10,minRotation:25,maxRotation:25,callback:function(a,t,e){var s=Math.floor(e.length/7);return s<1||(e.length-t-1)%s==0?a:void 0}},offset:!1,gridLines:{offsetGridLines:!1}}],yAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:6,padding:20,callback:function(a){if(Math.floor(a)===a)return a}}}]},elements:{line:{tension:0}},animation:{duration:0},hover:{animationDuration:0},legend:{display:!1},tooltips:{displayColors:!1},responsiveAnimationDuration:0}},init:function(){var a;i.$canvas.length&&(a=i.$canvas[0].getContext("2d"),d.instance=new Chart(a,d.settings),d.updateUI(wp_mail_smtp_dashboard_widget.chart_data))},ajaxUpdate:function(a){var t={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_get_chart_data",days:a};i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.ajaxUpdate"),s.post(ajaxurl,t,function(a){d.updateUI(a)})},updateUI:function(a){i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.updateUI");var t=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val();s.isEmptyObject(a)?(t="line",d.updateWithEmptyData(),d.showEmptyDataMessage()):(d.updateData(a),d.removeEmptyDataMessage()),d.updateColorScheme(i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val()),d.updateStyle(t),d.updateDatasets(),d.instance.update()},updateData:function(a){d.settings.data.labels=[],d.cachedData.confirmed=[],d.cachedData.unconfirmed=[],d.cachedData.sent=[],d.cachedData.failed=[],s.each(a,function(a,t){var e=moment(t.day);d.settings.data.labels.push(e),d.cachedData.confirmed.push({t:e,y:t.delivered}),d.cachedData.unconfirmed.push({t:e,y:t.sent}),d.cachedData.sent.push({t:e,y:t.sent+t.delivered}),d.cachedData.failed.push({t:e,y:t.unsent})}),d.updateChartData()},updateChartData:function(){d.settings.data.datasets=a.slice(),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].data=d.cachedData.sent,d.settings.data.datasets[1].data=d.cachedData.failed):(d.settings.data.datasets[0].data=d.cachedData.confirmed,d.settings.data.datasets[1].data=d.cachedData.unconfirmed,d.settings.data.datasets[2].data=d.cachedData.failed)},updateWithEmptyData:function(){d.settings.data.labels=[];var a,t,e=moment().startOf("day"),s=i.$daysSelect.val()||7;for(t=1;t<=s;t++)a=e.clone().subtract(t,"days"),d.settings.data.labels.push(a)},updateColorScheme:function(a){var t=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val(),e=["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)"];"smtp"===a?e=d.updateSmtpColorScheme():"wp"===a&&(e=d.updateWpColorScheme()),"bar"===t&&(wp_mail_smtp_dashboard_widget.no_send_confirmations?(e[0]=d.settings.data.datasets[0].borderColor,e[2]=d.settings.data.datasets[1].borderColor):(e[0]=d.settings.data.datasets[0].borderColor,e[1]=d.settings.data.datasets[1].borderColor,e[2]=d.settings.data.datasets[2].borderColor)),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].backgroundColor=e[0],d.settings.data.datasets[1].backgroundColor=e[2]):(d.settings.data.datasets[0].backgroundColor=e[0],d.settings.data.datasets[1].backgroundColor=e[1],d.settings.data.datasets[2].backgroundColor=e[2])},updateSmtpColorScheme:function(){var a="rgba(0, 0, 0, 0)",t="rgba(0, 0, 0, 0)",e="rgba(0, 0, 0, 0)";return"all"!==i.$emailTypeSelect.val()&&(a="rgba(106, 160, 139, 0.16)",t="rgba(167, 170, 173, 0.16)",e="rgba(214, 54, 56, 0.16)"),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].borderColor="rgba(106, 160, 139, 1)",d.settings.data.datasets[1].borderColor="rgba(214, 54, 56, 1)"):(d.settings.data.datasets[0].borderColor="rgba(106, 160, 139, 1)",d.settings.data.datasets[1].borderColor="rgba(167, 170, 173, 1)",d.settings.data.datasets[2].borderColor="rgba(214, 54, 56, 1)"),[a,t,e]},updateWpColorScheme:function(){var a="rgba(0, 0, 0, 0)",t="rgba(0, 0, 0, 0)",e="rgba(0, 0, 0, 0)";return"all"!==i.$emailTypeSelect.val()&&(a="rgba(34, 113, 177, 0.16)",t="rgba(167, 170, 173, 0.16)",e="rgba(214, 54, 56, 0.16)"),wp_mail_smtp_dashboard_widget.no_send_confirmations?(d.settings.data.datasets[0].borderColor="rgba(34, 113, 177, 1)",d.settings.data.datasets[1].borderColor="rgba(214, 54, 56, 1)"):(d.settings.data.datasets[0].borderColor="rgba(34, 113, 177, 1)",d.settings.data.datasets[1].borderColor="rgba(167, 170, 173, 1)",d.settings.data.datasets[2].borderColor="rgba(214, 54, 56, 1)"),[a,t,e]},updateDatasets:function(){var a=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val();"line"===a?d.updateLineDatasets():"bar"===a&&d.updateBarDatasets()},updateLineDatasets:function(){switch(i.$emailTypeSelect.val()){case"delivered":d.settings.data.datasets[1].data=[],wp_mail_smtp_dashboard_widget.no_send_confirmations||(d.settings.data.datasets[2].data=[]);break;case"sent":wp_mail_smtp_dashboard_widget.no_send_confirmations?d.settings.data.datasets[1].data=[]:(d.settings.data.datasets[0].data=[],d.settings.data.datasets[2].data=[]);break;case"unsent":d.settings.data.datasets[0].data=[],wp_mail_smtp_dashboard_widget.no_send_confirmations||(d.settings.data.datasets[1].data=[])}},updateBarDatasets:function(){switch(i.$emailTypeSelect.val()){case"delivered":d.settings.data.datasets=d.settings.data.datasets.slice(0,1);break;case"sent":d.settings.data.datasets=wp_mail_smtp_dashboard_widget.no_send_confirmations?d.settings.data.datasets.slice(0,1):d.settings.data.datasets.slice(1,2);break;case"unsent":d.settings.data.datasets=wp_mail_smtp_dashboard_widget.no_send_confirmations?d.settings.data.datasets.slice(1):d.settings.data.datasets.slice(2)}},updateStyle:function(a){"line"===(d.settings.type=a)?(d.settings.options.scales.xAxes[0].offset=!1,d.settings.options.scales.xAxes[0].gridLines.offsetGridLines=!1):"bar"===a&&(d.settings.options.scales.xAxes[0].offset=!0,d.settings.options.scales.xAxes[0].gridLines.offsetGridLines=!0)},showEmptyDataMessage:function(){d.removeEmptyDataMessage(),i.$canvas.after(wp_mail_smtp_dashboard_widget.empty_chart_html)},removeEmptyDataMessage:function(){i.$canvas.siblings(".wp-mail-smtp-error").remove()},events:{daysChanged:function(){var a=i.$daysSelect.val();d.ajaxUpdate(a),i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.daysChanged",a)},emailTypeChanged:function(){var a=i.$emailTypeSelect.val();d.updateChartData(),d.updateColorScheme(i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val()),d.updateDatasets(),d.instance.update(),i.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.emailTypeChanged",a)}}},n={chart:d,init:function(){s(n.ready)},ready:function(){n.events(),d.init(),n.refreshEmailStats(i.$emailTypeSelect.val())},events:function(){n.chartEvents(),n.miscEvents()},chartEvents:function(){i.$daysSelect.change(function(){d.events.daysChanged(),n.updateEmailStats(s(this).val(),i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val())}),i.$emailTypeSelect.change(function(){d.events.emailTypeChanged(),n.refreshEmailStats(s(this).val())})},miscEvents:function(){i.$recomBlockDismissBtn.click(function(){n.dismissRecommendedBlock()}),i.$settingsBtn.click(function(){s(this).siblings(".wp-mail-smtp-dash-widget-settings-menu").toggle()}),i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu-save").click(function(){n.saveSettings()}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.ajaxUpdate",function(){n.addOverlay(i.$canvas)}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.updateUI",function(){n.removeOverlay(i.$canvas)}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.daysChanged",function(a,t){n.saveWidgetMeta("timespan",t)}),i.$widget.on("WPMailSMTP.Admin.DashboardWidget.emailTypeChanged",function(a,t){n.saveWidgetMeta("email_type",t)})},updateEmailStats:function(t,a){var e={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_get_email_stats",days:t,color:a};n.addOverlay(i.$emailStatsBlock.children().first()),s.post(ajaxurl,e,function(a){i.$emailStatsBlock.html(a),n.refreshEmailStats(i.$emailTypeSelect.val()),n.saveWidgetMeta("timespan",t)})},refreshEmailStats:function(a){var t=i.$emailStatsBlock.find(".wp-mail-smtp-dash-widget-email-stats-table-cell");"all"!==a?(t.hide(),i.$emailStatsBlock.find(".wp-mail-smtp-dash-widget-email-stats-table-cell--"+a).show()):t.show()},saveSettings:function(){var a=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val(),t=i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val();a&&n.saveWidgetMeta("graph_style",a),t&&n.saveWidgetMeta("color_scheme",t),n.updateEmailStats(i.$daysSelect.val(),t),d.updateChartData(),d.updateColorScheme(t),d.updateStyle(a),d.updateDatasets(),d.instance.update(),i.$widget.find(".wp-mail-smtp-dash-widget-settings-menu").hide()},saveWidgetMeta:function(a,t){var e={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_save_widget_meta",meta:a,value:t};s.post(ajaxurl,e)},addOverlay:function(a){a.parent().closest(".wp-mail-smtp-dash-widget-block").length&&(n.removeOverlay(a),a.after('<div class="wp-mail-smtp-dash-widget-overlay"></div>'))},removeOverlay:function(a){a.siblings(".wp-mail-smtp-dash-widget-overlay").remove()},dismissRecommendedBlock:function(){s(".wp-mail-smtp-dash-widget-recommended-plugin-block").remove(),n.saveWidgetMeta("hide_recommended_block",1)}};return n}((document,window,jQuery));WPMailSMTPDashboardWidget.init();