"use strict";var WPMailSmtpEmailLogsExport=window.WPMailSmtpEmailLogsExport||function(t,o){var i={$form:o("#wp-mail-smtp-tools-export-email-logs"),$dateFlatpickr:o("#wp-mail-smtp-tools-export-email-logs-date-flatpickr"),$submitButton:o("#wp-mail-smtp-tools-export-email-logs-submit"),$cancelButton:o("#wp-mail-smtp-tools-export-email-logs-cancel"),$processMsg:o("#wp-mail-smtp-tools-export-email-logs-process-msg")},s=wp_mail_smtp_tools_export_email_logs.i18n,a={},r={init:function(){o(r.ready)},ready:function(){a.processing=!1,r.initDateRange(),r.initSubmit(),r.events()},events:function(){o(t).on("csv_file_error",function(t,e){r.displaySubmitMsg(e,"error")})},exportAjaxStep:function(i,t){var e;i=i||1,a.processing&&(e=r.getAjaxPostData(i,t),o.post(ajaxurl,e).done(function(t){if(t.success&&t.data.total_steps>i)r.exportAjaxStep(++i,t.data.request_id);else{var e="";if(clearTimeout(a.timerId),!t.success)return r.displaySubmitMsg(t.data.error,"error"),void r.displaySubmitSpinner(!1);if(0===t.data.count)return r.displaySubmitMsg(s.prc_2_no_email_logs),void r.displaySubmitSpinner(!1);e=s.prc_3_done,e+="<br>"+s.prc_3_download+', <a href="#" class="wp-mail-smtp-download-link">'+s.prc_3_click_here+"</a>.",r.displaySubmitMsg(e,"info"),r.displaySubmitSpinner(!1),r.triggerDownload(t.data.request_id)}}).fail(function(t,e,i){clearTimeout(a.timerId),r.displaySubmitMsg(s.error_prefix+":<br>"+i,"error"),r.displaySubmitSpinner(!1)}))},getAjaxPostData:function(t,e){return 1===t?i.$form.serialize():{action:"wp_mail_smtp_tools_export_email_logs",nonce:wp_mail_smtp_tools_export_email_logs.nonce,request_id:e,step:t}},initSubmit:function(){i.$submitButton.on("click",function(t){t.preventDefault(),o(this).hasClass("wp-mail-smtp-btn-spinner-on")||(i.$submitButton.blur(),r.displaySubmitSpinner(!0),r.displaySubmitMsg(""),a.timerId=setTimeout(function(){r.displaySubmitMsg(s.prc_1_filtering+"<br>"+s.prc_1_please_wait,"info")},3e3),r.exportAjaxStep(1))}),i.$cancelButton.on("click",function(t){t.preventDefault(),i.$cancelButton.blur(),r.displaySubmitMsg(""),r.displaySubmitSpinner(!1)})},initDateRange:function(){var t=wp_mail_smtp_tools_export_email_logs.lang_code,e={rangeSeparator:" - "};"undefined"!==flatpickr&&Object.prototype.hasOwnProperty.call(flatpickr,"l10ns")&&Object.prototype.hasOwnProperty.call(flatpickr.l10ns,t)&&((e=flatpickr.l10ns[t]).rangeSeparator=" - "),i.$dateFlatpickr.flatpickr({altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",locale:e,mode:"range"})},displaySubmitSpinner:function(t){t?(i.$submitButton.addClass("wp-mail-smtp-btn-spinner-on"),i.$cancelButton.removeClass("hidden"),a.processing=!0):(i.$submitButton.removeClass("wp-mail-smtp-btn-spinner-on"),i.$cancelButton.addClass("hidden"),a.processing=!1)},displaySubmitMsg:function(t,e){a.processing&&(e&&"error"===e?i.$processMsg.addClass("wp-mail-smtp-error"):i.$processMsg.removeClass("wp-mail-smtp-error"),i.$processMsg.html(t),0<t.length?i.$processMsg.removeClass("hidden"):i.$processMsg.addClass("hidden"))},triggerDownload:function(t){var e=wp_mail_smtp_tools_export_email_logs.export_page;e+="&action=wp_mail_smtp_tools_export_download_result",e+="&nonce="+wp_mail_smtp_tools_export_email_logs.nonce,e+="&request_id="+t,i.$form.find("iframe").remove(),i.$form.append('<iframe src="'+e+'"></iframe>'),i.$processMsg.find(".wp-mail-smtp-download-link").attr("href",e)}};return r}(document,(window,jQuery));WPMailSmtpEmailLogsExport.init();