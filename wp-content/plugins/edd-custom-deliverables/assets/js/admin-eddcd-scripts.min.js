jQuery(document).ready(function(e){var d={init:function(){this.add(),this.move(),this.remove(),this.files()},clone_repeatable:function(d){var t=highest=1;return d.parent().find(".eddcd_repeatable_row").each(function(){var d=e(this).data("key");parseInt(d)>highest&&(highest=d)}),t=highest+=1,clone=d.clone(),clone.find("select").each(function(){e(this).val(d.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("edd_add_blank"),clone.attr("data-key",t),clone.find("input, select, textarea").val("").each(function(){var d=e(this).attr("name"),i=e(this).attr("id");d&&(d=d.replace(/\[(.*?)\]\[(.*?)\]\[(.*?)\]/,function(e,d,i,a){return"["+d+"]["+i+"]["+parseInt(t)+"]"}),e(this).attr("name",d)),e(this).attr("data-key",t),void 0!==i&&(i=i.replace(/(\d+)/,parseInt(t)),e(this).attr("id",i))}),clone.find("span.eddcd_price_id").each(function(){e(this).text(parseInt(t))}),clone.find("span.eddcd_file_id").each(function(){e(this).text(parseInt(t))}),clone.find(".eddcd_repeatable_default_input").each(function(){e(this).val(parseInt(t)).removeAttr("checked")}),clone.find(".eddcd_repeatable_condition_field").each(function(){e(this).find("option:eq(0)").prop("selected","selected")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){e(document.body).on("click",".submit .eddcd_add_repeatable",function(t){t.preventDefault();var i=e(this);e(this).attr("download-id");price_id=e(this).attr("price-id"),row=i.parent().parent().prev(".eddcd_repeatable_row"),clone=d.clone_repeatable(row),clone.insertAfter(row).find("input, textarea, select").filter(":visible").eq(0).focus(),clone.find(".edd-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option}),clone.find(".edd-select-chosen").css("width","100%"),clone.find(".edd-select-chosen .chosen-search input").attr("placeholder",edd_vars.search_placeholder)})},move:function(){e(".eddcd_repeatable_table .eddcd-repeatables-wrap").sortable({handle:".eddcd-draghandle-anchor",items:".eddcd_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var d=0;console.log("heyo"),e(this).find(".eddcd_repeatable_row").each(function(){e(this).find("input.eddcd_repeatable_index").each(function(){e(this).val(d)}),d++})}})},remove:function(){e(document.body).on("click",".eddcd-remove-row",function(d){d.preventDefault();var t,i=e(this).parents(".eddcd_repeatable_row"),a=i.parent().find(".eddcd_repeatable_row").length-1,l=e(this).data("type"),n="div.eddcd_repeatable_"+l+"s";t=(e(this).is(".ui-sortable .eddcd_repeatable_row:first-child .edd-remove-row")?i.next(".eddcd_repeatable_row"):i.prev(".eddcd_repeatable_row")).find("select, input, textarea, button").filter(":visible").eq(0);var o=e(this).attr("download-id"),s=e(this).attr("price-id");if(e("#edd-custom-deliverables-files-"+o+"-"+s+' .eddcd_repeatable_upload_wrapper[data-key="'+i.data("key")+'"]').remove(),a>1)e("input, select",i).val(""),i.fadeOut("fast").remove(),t.focus();else switch(l){case"price":alert(edd_vars.one_price_min);break;case"file":e("input, select",i).val("");break;default:alert(edd_vars.one_field_min)}e(n).each(function(d){e(this).find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(.*?)\]\[(.*?)\]\[(.*?)\]/,function(e,t,i,a){return console.log(e),"["+t+"]["+i+"]["+d+"]"}),e(this).attr("name",t).attr("id",t)})})})},files:function(){window.formfield="",e(document.body).on("click",".eddcd_upload_file_button",function(i){i.preventDefault();var a=e(this);window.formfield=e(this).closest(".eddcd_repeatable_upload_wrapper"),e.post(ajaxurl,{action:"edd_cd_turn_on_file_filter"},function(e){}),t?t.open():((t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:a.data("uploader-title"),button:{text:a.data("uploader-button-text")},multiple:"0"!=e(this).data("multiple")})).on("menu:render:default",function(e){var d={};e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set(d)}),t.on("insert",function(){t.state().get("selection").each(function(t,i){var a="image"===(t=t.toJSON()).type&&e(".attachment-display-settings .size option:selected").val(),l=t.url,n=t.title.length>0?t.title:t.filename;if(a&&void 0!==t.sizes[a]&&(l=t.sizes[a].url),"image"===t.type&&(n=a&&void 0!==t.sizes[a]?n+"-"+t.sizes[a].width+"x"+t.sizes[a].height:n+"-"+t.width+"x"+t.height),0===i)window.formfield.find(".eddcd_repeatable_attachment_id_field").val(t.id),window.formfield.find(".eddcd_repeatable_thumbnail_size_field").val(a),window.formfield.find(".eddcd_repeatable_upload_field").val(l),window.formfield.find(".eddcd_repeatable_name_field").val(n);else{var o=window.formfield,s=d.clone_repeatable(o);s.find(".eddcd_repeatable_attachment_id_field").val(t.id),s.find("edd_repeatable_thumbnail_size_field").val(a),s.find(".eddcd_repeatable_upload_field").val(l),s.find(".eddcd_repeatable_name_field").val(n),s.insertAfter(o)}}),e.post(ajaxurl,{action:"edd_cd_turn_off_file_filter"},function(e){})}),t.open(),e(".edd-custom-deliverables-send-email-wrapper").html(edd_custom_deliverables_vars.save_payment_text))});var t;window.formfield=""}};d.init(),e(document).on("click","#edd-custom-deliverables-email-customer",function(d){d.preventDefault(),e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","visible"),e("#edd-custom-deliverables-email-customer").css("display","none");var t;t=e("#wp-edd-custom-deliverables-email-body-wrap").hasClass("tmce-active")?tinyMCE.activeEditor.getContent():jQuery("#edd-custom-deliverables-email-body").val(),e.ajax({type:"POST",url:ajaxurl,data:{nonce:e("#edd-custom-deliverables-send-email").val(),subject:e("#edd-custom-deliverables-subject").val(),body:t,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_send_email_ajax"},dataType:"json",success:function(d){d.success?(e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","hidden"),e("#edd-custom-deliverables-email-customer").after('<span id="edd-custom-deliverables-email-successful-message">'+d.success_message+"</span>"),setTimeout(function(){location.reload()},2e3)):console.log(d)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document).on("click",".eddcd-fulfill-order-btn",function(d){d.preventDefault(),fulfilled_box=e(this).parent(),fulfilled_box.children().hide(),fulfilled_box.next().css("visibility","visible").css("display","inline-block"),download_id=e(this).attr("download-id"),price_id=e(this).attr("price-id"),e.ajax({type:"POST",url:ajaxurl,data:{nonce:e("#edd-custom-deliverables-mark-as-fulfilled").val(),download_id:download_id,price_id:price_id,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_mark_as_fulfilled"},dataType:"json",success:function(e){e.success?(fulfilled_box.next().css("visibility","hidden").css("display","none"),fulfilled_box.html(e.success_message)):console.log(e)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document).on("click",".eddcd-mark-not-fulfilled",function(d){d.preventDefault(),fulfilled_box=e(this).parent().parent(),fulfilled_box.children().hide(),fulfilled_box.next().css("visibility","visible").css("display","inline-block"),download_id=e(this).attr("download-id"),price_id=e(this).attr("price-id"),e.ajax({type:"POST",url:ajaxurl,data:{nonce:e("#edd-custom-deliverables-mark-as-not-fulfilled").val(),download_id:download_id,price_id:price_id,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_mark_as_not_fulfilled"},dataType:"json",success:function(e){e.success?(fulfilled_box.next().css("visibility","hidden").css("display","none"),fulfilled_box.html(e.success_message)):console.log(e)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})});
