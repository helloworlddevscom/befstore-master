jQuery(document).ready(function(e){var d={init:function(){this.add(),this.move(),this.remove(),this.files()},clone_repeatable:function(d){var t=highest=1;return d.parent().find(".eddcd_repeatable_row").each(function(){var d=e(this).data("key");parseInt(d)>highest&&(highest=d)}),t=highest+=1,clone=d.clone(),clone.find("select").each(function(){e(this).val(d.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("edd_add_blank"),clone.attr("data-key",t),clone.find("input, select, textarea").val("").each(function(){var d=e(this).attr("name"),a=e(this).attr("id");d&&(d=d.replace(/\[(.*?)\]\[(.*?)\]\[(.*?)\]/,function(e,d,a,i){return"["+d+"]["+a+"]["+parseInt(t)+"]"}),e(this).attr("name",d)),e(this).attr("data-key",t),void 0!==a&&(a=a.replace(/(\d+)/,parseInt(t)),e(this).attr("id",a))}),clone.find("span.eddcd_price_id").each(function(){e(this).text(parseInt(t))}),clone.find("span.eddcd_file_id").each(function(){e(this).text(parseInt(t))}),clone.find(".eddcd_repeatable_default_input").each(function(){e(this).val(parseInt(t)).removeAttr("checked")}),clone.find(".eddcd_repeatable_condition_field").each(function(){e(this).find("option:eq(0)").prop("selected","selected")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){e(document.body).on("click",".submit .eddcd_add_repeatable",function(t){t.preventDefault();var a=e(this);e(this).attr("download-id");price_id=e(this).attr("price-id"),row=a.parent().parent().prev(".eddcd_repeatable_row"),clone=d.clone_repeatable(row),clone.insertAfter(row).find("input, textarea, select").filter(":visible").eq(0).focus()})},move:function(){e(".eddcd_repeatable_table .eddcd-repeatables-wrap").sortable({handle:".eddcd-draghandle-anchor",items:".eddcd_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var d=0;e(this).find(".eddcd_repeatable_row").each(function(){e(this).find("input.eddcd_repeatable_index").each(function(){e(this).val(d)}),d++})}})},remove:function(){e(document.body).on("click",".eddcd-remove-row",function(d){d.preventDefault();var t,a=e(this).parents(".eddcd_repeatable_row"),i=a.parent().find(".eddcd_repeatable_row").length,l=e(this).data("type");t=(e(this).is(".ui-sortable .eddcd_repeatable_row:first-child .edd-remove-row")?a.next(".eddcd_repeatable_row"):a.prev(".eddcd_repeatable_row")).find("select, input, textarea, button").filter(":visible").eq(0);var n=e(this).attr("download-id"),o=e(this).attr("price-id");if(i>1)e("input, select",a).val(""),a.fadeOut("fast").remove(),t.focus(),e("#edd-custom-deliverables-files-"+n+"-"+o+' .eddcd_repeatable_upload_wrapper[data-key="'+a.data("key")+'"]').remove();else switch(l){case"price":alert(edd_vars.one_price_min);break;case"file":e("input, select",a).val("");break;default:alert(edd_vars.one_field_min)}})},files:function(d){e(document.body).on("click",".eddcd_upload_file_button",function(d){var t,a=e(this);t?t.open():((t=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:!1})).on("open",function(){var d=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-formid"),t=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-fieldname");e.post(fes_form.ajaxurl,{action:"fes_turn_on_file_filter",formid:d,name:t},function(e){})}),t.on("close",function(){var d=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-formid"),t=a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").attr("data-fieldname");e.post(fes_form.ajaxurl,{action:"fes_turn_off_file_filter",formid:d,name:t},function(e){})}),t.on("select",function(){t.state().get("selection").map(function(e){e=e.toJSON(),a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_attachment_id_field").val(e.id),a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_name_field").val(e.title),a.closest(".eddcd-repeatable-row-standard-fields").find("input.eddcd_repeatable_upload_field").val(e.url)})}),t.open(),e(".edd-custom-deliverables-send-email-wrapper").html(edd_custom_deliverables_fes_vars.save_payment_text))})}};d.init(),e(document).on("click","#edd-custom-deliverables-email-customer",function(d){e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","visible"),e("#edd-custom-deliverables-email-customer").css("display","none"),e.ajax({type:"POST",url:fes_form.ajaxurl,data:{nonce:e("#edd-custom-deliverables-send-email").val(),payment_id:e("#edd-custom-deliverables-payment-id").val(),vendor_id:e("#edd-custom-deliverables-vendor-id").val(),action:"edd_custom_deliverables_send_fes_email_ajax"},dataType:"json",success:function(d){d.success?(e(".edd-custom-deliverables-send-email-wrapper .spinner").css("visibility","hidden"),e("#edd-custom-deliverables-email-customer").after('<span id="edd-custom-deliverables-email-successful-message">'+d.success_message+"</span>"),setTimeout(function(){location.reload()},2e3)):console.log(d)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document).on("click",".eddcd-fulfill-order-btn",function(d){d.preventDefault(),fulfilled_box=e(this).parent(),fulfilled_box.children().hide(),fulfilled_box.next().css("visibility","visible").css("display","inline-block"),download_id=e(this).attr("download-id"),price_id=e(this).attr("price-id"),e.ajax({type:"POST",url:fes_form.ajaxurl,data:{nonce:e("#edd-custom-deliverables-mark-as-fulfilled").val(),download_id:download_id,price_id:price_id,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_mark_as_fulfilled"},dataType:"json",success:function(e){e.success?(fulfilled_box.next().css("visibility","hidden").css("display","none"),fulfilled_box.html(e.success_message)):console.log(e)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}),e(document).on("click",".eddcd-mark-not-fulfilled",function(d){d.preventDefault(),fulfilled_box=e(this).parent().parent(),fulfilled_box.children().hide(),fulfilled_box.next().css("visibility","visible").css("display","inline-block"),download_id=e(this).attr("download-id"),price_id=e(this).attr("price-id"),e.ajax({type:"POST",url:fes_form.ajaxurl,data:{nonce:e("#edd-custom-deliverables-mark-as-not-fulfilled").val(),download_id:download_id,price_id:price_id,payment_id:e("#edd-custom-deliverables-payment-id").val(),action:"edd_custom_deliverables_mark_as_not_fulfilled"},dataType:"json",success:function(e){e.success?(fulfilled_box.next().css("visibility","hidden").css("display","none"),fulfilled_box.html(e.success_message)):console.log(e)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})});
